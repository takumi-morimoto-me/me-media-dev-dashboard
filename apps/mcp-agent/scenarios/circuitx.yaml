# CircuitX シナリオ定義
name: circuitx
display_name: "CircuitX（ビギナーズ）"
asp_name_in_db: "CircuitX（ビギナーズ）"
login_url: https://x-dashboard.cir.io/

credentials:
  username_key: CIRCUITX_USERNAME
  password_key: CIRCUITX_PASSWORD

# 月次データ取得シナリオ
monthly:
  description: "月別レポートから発生報酬を取得"
  actions:
    - action: navigate
      value: https://x-dashboard.cir.io/
    - action: wait
      milliseconds: 3000
    # ログインフォーム入力
    - action: fill
      selector: "input[type='email'], input[name='email']"
      value: "{SECRET:CIRCUITX_USERNAME}"
    - action: fill
      selector: "input[type='password']"
      value: "{SECRET:CIRCUITX_PASSWORD}"
    - action: click
      selector: "button[type='submit'], button:has-text('ログイン'), input[type='submit']"
    - action: wait
      milliseconds: 5000
    # サイドバーからレポートをクリック
    - action: click
      selector: "a:has-text('レポート')"
    - action: wait
      milliseconds: 3000
    # 詳細レポートセクションまでスクロール
    - action: scroll
      selector: "body"
      direction: down
      amount: 500
    - action: wait
      milliseconds: 2000
    # 月別タブをクリック
    - action: click
      selector: "span:has-text('月別'), a:has-text('月別'), button:has-text('月別')"
    - action: wait
      milliseconds: 3000
    # スクリーンショットを撮る
    - action: screenshot
      path: "/tmp/circuitx_monthly.png"
    # 月別テーブルからデータ抽出
    # テーブル構造: 年月, Click, CV, CVR, 金額
    - action: extract
      selector: "table"
      target: actuals
      columns:
        - name: month
          selector: "td:nth-child(1)"
        - name: clicks
          selector: "td:nth-child(2)"
        - name: cv
          selector: "td:nth-child(3)"
        - name: cvr
          selector: "td:nth-child(4)"
        - name: amount
          selector: "td:nth-child(5)"

# 日次データ取得シナリオ
daily:
  description: "日別レポートから発生報酬を取得"
  actions:
    - action: navigate
      value: https://x-dashboard.cir.io/
    - action: wait
      milliseconds: 3000
    # ログインフォーム入力
    - action: fill
      selector: "input[type='email'], input[name='email']"
      value: "{SECRET:CIRCUITX_USERNAME}"
    - action: fill
      selector: "input[type='password']"
      value: "{SECRET:CIRCUITX_PASSWORD}"
    - action: click
      selector: "button[type='submit'], button:has-text('ログイン'), input[type='submit']"
    - action: wait
      milliseconds: 5000
    # サイドバーからレポートをクリック
    - action: click
      selector: "a:has-text('レポート')"
    - action: wait
      milliseconds: 3000
    # 詳細レポートセクションまでスクロール
    - action: scroll
      selector: "body"
      direction: down
      amount: 500
    - action: wait
      milliseconds: 2000
    # 日別タブをクリック（デフォルトで選択されている可能性あり）
    - action: click
      selector: "span:has-text('日別'), a:has-text('日別'), button:has-text('日別')"
    - action: wait
      milliseconds: 3000
    # スクリーンショットを撮る
    - action: screenshot
      path: "/tmp/circuitx_daily.png"
    # 日別テーブルからデータ抽出
    # テーブル構造: 日付, Click, CV, CVR, 金額
    - action: extract
      selector: "table"
      target: daily_actuals
      columns:
        - name: date
          selector: "td:nth-child(1)"
        - name: clicks
          selector: "td:nth-child(2)"
        - name: cv
          selector: "td:nth-child(3)"
        - name: cvr
          selector: "td:nth-child(4)"
        - name: amount
          selector: "td:nth-child(5)"

# リトライ設定
retry:
  max_attempts: 3
  delay_ms: 2000
  retry_on:
    - timeout
    - element_not_found
