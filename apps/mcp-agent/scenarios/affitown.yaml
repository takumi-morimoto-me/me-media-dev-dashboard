# affitown (アフィタウン) シナリオ定義
name: affitown
display_name: "アフィタウン"
asp_name_in_db: "affitown(SIM通信・おいくら・高マガ・SIMチェンジ・ビギ）"
login_url: https://affitown.jp/

credentials:
  username_key: AFFITOWN_USERNAME
  password_key: AFFITOWN_PASSWORD

# 月次データ取得シナリオ
monthly:
  description: "月別レポートから報酬を取得"
  actions:
    # ログイン
    - action: navigate
      value: https://affitown.jp/
    - action: wait
      milliseconds: 2000
    # パートナー様ログインフォームに入力（最初のフォーム）
    - action: fill
      selector: "form[action='/partner/login/confirm'] input[name='loginId']"
      value: "{SECRET:AFFITOWN_USERNAME}"
    - action: fill
      selector: "form[action='/partner/login/confirm'] input[name='password']"
      value: "{SECRET:AFFITOWN_PASSWORD}"
    - action: click
      selector: "form[action='/partner/login/confirm'] input[type='submit']"
    - action: wait
      milliseconds: 5000
    # スクリーンショットを撮る
    - action: screenshot
      path: "/tmp/affitown_after_login.png"
    # 報酬金額一覧ページに直接移動
    - action: navigate
      value: https://affitown.jp/partneradmin/report/reward/price/list
    - action: wait
      milliseconds: 3000
    # スクリーンショットを撮る
    - action: screenshot
      path: "/tmp/affitown_report.png"
    # データ抽出（横型テーブル）
    - action: extract
      selector: "table"
      target: actuals
      horizontal: true

# 日次データ取得シナリオ
daily:
  description: "日別レポートから報酬を取得"
  actions:
    # ログイン
    - action: navigate
      value: https://affitown.jp/
    - action: wait
      milliseconds: 2000
    # パートナー様ログインフォームに入力（最初のフォーム）
    - action: fill
      selector: "form[action='/partner/login/confirm'] input[name='loginId']"
      value: "{SECRET:AFFITOWN_USERNAME}"
    - action: fill
      selector: "form[action='/partner/login/confirm'] input[name='password']"
      value: "{SECRET:AFFITOWN_PASSWORD}"
    - action: click
      selector: "form[action='/partner/login/confirm'] input[type='submit']"
    - action: wait
      milliseconds: 5000
    # 時系列レポートページに直接移動
    - action: navigate
      value: https://affitown.jp/partneradmin/report/timeseries
    - action: wait
      milliseconds: 3000
    # スクリーンショットを撮る
    - action: screenshot
      path: "/tmp/affitown_daily_report.png"
    # データ抽出
    - action: extract
      selector: "table"
      target: daily_actuals

# リトライ設定
retry:
  max_attempts: 3
  delay_ms: 2000
  retry_on:
    - timeout
    - element_not_found
