# Link-AG（ビギナーズ）シナリオ定義
name: linkag
display_name: "Link-AG（ビギナーズ）"
asp_name_in_db: "Link-AG（ビギナーズ）"
login_url: https://link-ag.net/

credentials:
  username_key: LINKAG_USERNAME
  password_key: LINKAG_PASSWORD

# 月次データ取得シナリオ
monthly:
  description: "月別レポートから確定報酬金額（税抜）を取得"
  actions:
    - action: navigate
      value: https://link-ag.net/
    - action: wait
      milliseconds: 3000
    # ログインフォーム入力
    - action: fill
      selector: "input[name='login_id'], input[type='text']:first-of-type, input#login_id"
      value: "{SECRET:LINKAG_USERNAME}"
    - action: fill
      selector: "input[name='password'], input[type='password']"
      value: "{SECRET:LINKAG_PASSWORD}"
    - action: click
      selector: "button[type='submit'], input[type='submit'], button:has-text('ログイン')"
      no_wait_after: true
      timeout: 30000
    - action: wait
      milliseconds: 8000
    # スクリーンショットを撮る（ログイン後）
    - action: screenshot
      path: "/tmp/linkag_after_login.png"
    # レポートメニューにホバー（ドロップダウンを表示）
    - action: hover
      selector: "a:has-text('レポート'), li:has-text('レポート'), nav a:has-text('レポート')"
    - action: wait
      milliseconds: 1500
    # スクリーンショットを撮る（メニュー展開後）
    - action: screenshot
      path: "/tmp/linkag_menu.png"
    # 月別をクリック
    - action: click
      selector: "a:has-text('月別')"
    - action: wait
      milliseconds: 5000
    # スクリーンショットを撮る（月別ページ）
    - action: screenshot
      path: "/tmp/linkag_monthly.png"
    # テーブルからデータ抽出（確定報酬金額(税抜)カラムを指定）
    - action: extract
      selector: "table"
      target: actuals
      amount_column_pattern: "確定報酬金額(税抜)"
      columns:
        - name: month
          selector: "td:nth-child(1)"
        - name: amount
          selector: "td:last-child"

# 日次データ取得シナリオ（CSVダウンロード）
daily:
  description: "日別レポートからCSVダウンロードして確定報酬金額（税抜）を取得"
  actions:
    - action: navigate
      value: https://link-ag.net/
    - action: wait
      milliseconds: 3000
    # ログインフォーム入力
    - action: fill
      selector: "input[name='login_id'], input[type='text']:first-of-type, input#login_id"
      value: "{SECRET:LINKAG_USERNAME}"
    - action: fill
      selector: "input[name='password'], input[type='password']"
      value: "{SECRET:LINKAG_PASSWORD}"
    - action: click
      selector: "button[type='submit'], input[type='submit'], button:has-text('ログイン')"
      no_wait_after: true
      timeout: 30000
    - action: wait
      milliseconds: 8000
    # スクリーンショットを撮る（ログイン後）
    - action: screenshot
      path: "/tmp/linkag_after_login.png"
    # レポートメニューにホバー（ドロップダウンを表示）
    - action: hover
      selector: "a:has-text('レポート'), li:has-text('レポート'), nav a:has-text('レポート')"
    - action: wait
      milliseconds: 1500
    # スクリーンショットを撮る（メニュー展開後）
    - action: screenshot
      path: "/tmp/linkag_menu.png"
    # 日別をクリック
    - action: click
      selector: "a:has-text('日別')"
    - action: wait
      milliseconds: 5000
    # スクリーンショットを撮る（日別ページ）
    - action: screenshot
      path: "/tmp/linkag_daily.png"
    # CSVダウンロード
    - action: download
      selector: "button:has-text('ダウンロード'), a:has-text('ダウンロード'), button:has-text('CSV')"
      path: "/tmp/linkag_daily.csv"
    - action: wait
      milliseconds: 3000
    # CSVからデータ抽出
    - action: extract_csv
      path: "/tmp/linkag_daily.csv"
      target: daily_actuals
      date_column: "日付"
      amount_column: "確定報酬金額(税抜)"

# リトライ設定
retry:
  max_attempts: 3
  delay_ms: 2000
  retry_on:
    - timeout
    - element_not_found
