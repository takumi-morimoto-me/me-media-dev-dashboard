{"version":3,"sources":["turbopack:///[project]/apps/dashboard/src/components/financials/financials-client.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/apps/dashboard/src/app/dashboard/financials/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/apps/dashboard/src/components/financials/financials-client.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/dashboard/src/components/financials/financials-client.tsx\",\n    \"default\",\n);\n","import { createClient } from \"@/lib/supabase/server\";\nimport FinancialsClient from \"@/components/financials/financials-client\";\n\nexport const dynamic = 'force-dynamic';\n\ninterface FinancialsPageProps {\n  searchParams: Promise<{\n    media?: string;\n    year?: string;\n  }>;\n}\n\nexport default async function FinancialsPage({ searchParams }: FinancialsPageProps) {\n  const supabase = await createClient();\n  const params = await searchParams;\n\n  // Parallel fetch for settings, monthly data, daily data, and account items\n  const settingPromise = supabase\n    .from('app_settings')\n    .select('value')\n    .eq('key', 'fiscal_year_start_month')\n    .single();\n\n  const mediaParam = params.media || 'all';\n  const year = params.year ? parseInt(params.year) : new Date().getFullYear();\n  const mediaId = mediaParam === 'all' ? null : mediaParam;\n\n  const monthlyDataPromise = supabase.rpc('get_financial_monthly_data', {\n    p_media_id: mediaId,\n    p_fiscal_year: year,\n  });\n\n  const dailyDataPromise = supabase.rpc('get_financial_daily_data', {\n    p_media_id: mediaId,\n    p_fiscal_year: year,\n  });\n\n  const accountItemsPromise = mediaId\n    ? supabase\n        .from('account_items')\n        .select('id, name, parent_id, display_order')\n        .eq('media_id', mediaId)\n    : supabase\n        .from('account_items')\n        .select('id, name, parent_id, display_order');\n\n  const [\n    { data: setting, error: settingError },\n    { data: monthlyData, error: monthlyDataError },\n    { data: dailyData, error: dailyDataError },\n    { data: accountItems, error: accountItemsError }\n  ] = await Promise.all([\n    settingPromise,\n    monthlyDataPromise,\n    dailyDataPromise,\n    accountItemsPromise\n  ]);\n\n  // Default to 6 if not set, but log the error\n  const fiscalYearStartMonth = setting?.value ? parseInt(setting.value) : 6;\n  if (settingError) {\n    console.error(\"Error fetching fiscal year start month setting:\", settingError);\n  }\n\n  if (monthlyDataError || dailyDataError || accountItemsError) {\n    console.error(\"Error fetching page data:\", { monthlyDataError, dailyDataError, accountItemsError });\n    return (\n      <FinancialsClient\n        monthlyData={[]}\n        dailyData={[]}\n        accountItems={[]}\n        fiscalYearStartMonth={fiscalYearStartMonth}\n      />\n    );\n  }\n\n  return (\n    <FinancialsClient\n      monthlyData={monthlyData || []}\n      dailyData={dailyData || []}\n      accountItems={accountItems || []}\n      fiscalYearStartMonth={fiscalYearStartMonth}\n    />\n  );\n}\n"],"names":[],"mappings":"kSAEe,CAAA,EAAA,AADf,EAAA,CAAA,CAAA,MACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,gUAAkU,EAC/V,+FACA,gEAHW,CAAA,EADf,AACe,EADf,CAAA,CAAA,MACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,4SAA8S,EAC3U,2EACA,sJCLJ,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OAEO,IAAM,EAAU,gBASR,eAAe,EAAe,cAAE,CAAY,CAAuB,EAChF,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAC7B,EAAS,MAAM,EAGf,EAAiB,EACpB,IAAI,CAAC,gBACL,MAAM,CAAC,SACP,EAAE,CAAC,MAAO,2BACV,MAAM,GAEH,EAAa,EAAO,KAAK,EAAI,MAC7B,EAAO,EAAO,IAAI,CAAG,SAAS,EAAO,IAAI,EAAI,IAAI,OAAO,WAAW,GACnE,EAAyB,AAAf,UAAuB,KAAO,EAExC,EAAqB,EAAS,GAAG,CAAC,6BAA8B,CACpE,WAAY,EACZ,cAAe,CACjB,GAEM,EAAmB,EAAS,GAAG,CAAC,2BAA4B,CAChE,WAAY,EACZ,cAAe,CACjB,GAEM,EAAsB,EACxB,EACG,IAAI,CAAC,iBACL,MAAM,CAAC,sCACP,EAAE,CAAC,WAAY,GAClB,EACG,IAAI,CAAC,iBACL,MAAM,CAAC,sCAER,CACJ,CAAE,KAAM,CAAO,CAAE,MAAO,CAAY,CAAE,CACtC,CAAE,KAAM,CAAW,CAAE,MAAO,CAAgB,CAAE,CAC9C,CAAE,KAAM,CAAS,CAAE,MAAO,CAAc,CAAE,CAC1C,CAAE,KAAM,CAAY,CAAE,MAAO,CAAiB,CAAE,CACjD,CAAG,MAAM,QAAQ,GAAG,CAAC,CACpB,EACA,EACA,EACA,EACD,EAGK,EAAuB,GAAS,MAAQ,SAAS,EAAQ,KAAK,EAAI,QAKxE,CAJI,GACF,QAAQ,GADQ,EACH,CAAC,kDAAmD,GAG/D,GAAoB,GAAkB,IACxC,QAAQ,KAAK,CAAC,CAD6C,2BAChB,kBAAE,iBAAkB,oBAAgB,CAAkB,GAE/F,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAgB,CAAA,CACf,YAAa,EAAE,CACf,UAAW,EAAE,CACb,aAAc,EAAE,CAChB,qBAAsB,KAM1B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAgB,CAAA,CACf,YAAa,GAAe,EAAE,CAC9B,UAAW,GAAa,EAAE,CAC1B,aAAc,GAAgB,EAAE,CAChC,qBAAsB,GAG5B","ignoreList":[0]}