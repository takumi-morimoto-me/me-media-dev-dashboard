module.exports=[33806,a=>{"use strict";a.s(["default",()=>aZ],33806);var b=a.i(11755),c=a.i(80150),d=a.i(30718),e=a.i(98674),f=a.i(68415),g=a.i(61872),h=a.i(50916),i=a.i(21211);let j=(0,i.default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);var k=a.i(13484),l=a.i(62612),m=a.i(59653),n=a.i(57948),o=a.i(17237),p=a.i(9346),q=a.i(34543),r=a.i(596),s="Checkbox",[t,u]=(0,l.createContextScope)(s),[v,w]=t(s);function x(a){let{__scopeCheckbox:d,checked:e,children:f,defaultChecked:g,disabled:h,form:i,name:j,onCheckedChange:k,required:l,value:m="on",internal_do_not_use_render:o}=a,[p,q]=(0,n.useControllableState)({prop:e,defaultProp:g??!1,onChange:k,caller:s}),[r,t]=c.useState(null),[u,w]=c.useState(null),x=c.useRef(!1),y=!r||!!i||!!r.closest("form"),z={checked:p,disabled:h,setChecked:q,control:r,setControl:t,name:j,form:i,value:m,hasConsumerStoppedPropagationRef:x,required:l,defaultChecked:!F(g)&&g,isFormControl:y,bubbleInput:u,setBubbleInput:w};return(0,b.jsx)(v,{scope:d,...z,children:"function"==typeof o?o(z):f})}var y="CheckboxTrigger",z=c.forwardRef(({__scopeCheckbox:a,onKeyDown:d,onClick:e,...f},g)=>{let{control:h,value:i,disabled:j,checked:l,required:n,setControl:o,setChecked:p,hasConsumerStoppedPropagationRef:q,isFormControl:s,bubbleInput:t}=w(y,a),u=(0,k.useComposedRefs)(g,o),v=c.useRef(l);return c.useEffect(()=>{let a=h?.form;if(a){let b=()=>p(v.current);return a.addEventListener("reset",b),()=>a.removeEventListener("reset",b)}},[h,p]),(0,b.jsx)(r.Primitive.button,{type:"button",role:"checkbox","aria-checked":F(l)?"mixed":l,"aria-required":n,"data-state":G(l),"data-disabled":j?"":void 0,disabled:j,value:i,...f,ref:u,onKeyDown:(0,m.composeEventHandlers)(d,a=>{"Enter"===a.key&&a.preventDefault()}),onClick:(0,m.composeEventHandlers)(e,a=>{p(a=>!!F(a)||!a),t&&s&&(q.current=a.isPropagationStopped(),q.current||a.stopPropagation())})})});z.displayName=y;var A=c.forwardRef((a,c)=>{let{__scopeCheckbox:d,name:e,checked:f,defaultChecked:g,required:h,disabled:i,value:j,onCheckedChange:k,form:l,...m}=a;return(0,b.jsx)(x,{__scopeCheckbox:d,checked:f,defaultChecked:g,disabled:i,required:h,onCheckedChange:k,name:e,form:l,value:j,internal_do_not_use_render:({isFormControl:a})=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(z,{...m,ref:c,__scopeCheckbox:d}),a&&(0,b.jsx)(E,{__scopeCheckbox:d})]})})});A.displayName=s;var B="CheckboxIndicator",C=c.forwardRef((a,c)=>{let{__scopeCheckbox:d,forceMount:e,...f}=a,g=w(B,d);return(0,b.jsx)(q.Presence,{present:e||F(g.checked)||!0===g.checked,children:(0,b.jsx)(r.Primitive.span,{"data-state":G(g.checked),"data-disabled":g.disabled?"":void 0,...f,ref:c,style:{pointerEvents:"none",...a.style}})})});C.displayName=B;var D="CheckboxBubbleInput",E=c.forwardRef(({__scopeCheckbox:a,...d},e)=>{let{control:f,hasConsumerStoppedPropagationRef:g,checked:h,defaultChecked:i,required:j,disabled:l,name:m,value:n,form:q,bubbleInput:s,setBubbleInput:t}=w(D,a),u=(0,k.useComposedRefs)(e,t),v=(0,o.usePrevious)(h),x=(0,p.useSize)(f);c.useEffect(()=>{if(!s)return;let a=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,b=!g.current;if(v!==h&&a){let c=new Event("click",{bubbles:b});s.indeterminate=F(h),a.call(s,!F(h)&&h),s.dispatchEvent(c)}},[s,v,h,g]);let y=c.useRef(!F(h)&&h);return(0,b.jsx)(r.Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:i??y.current,required:j,disabled:l,name:m,value:n,form:q,...d,tabIndex:-1,ref:u,style:{...d.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function F(a){return"indeterminate"===a}function G(a){return F(a)?"indeterminate":a?"checked":"unchecked"}E.displayName=D;var H=a.i(64365),I=a.i(21305);let J=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(A,{ref:d,className:(0,I.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...c,children:(0,b.jsx)(C,{className:(0,I.cn)("flex items-center justify-center text-current"),children:(0,b.jsx)(H.Check,{className:"h-4 w-4"})})}));J.displayName=A.displayName;var K=a.i(95811);let L=a=>new Intl.NumberFormat("ja-JP").format(a),M=({item:a,headers:d,data:i,viewMode:k,level:l,expandedRows:m,toggleRow:n,selectedItems:o,toggleItemSelection:p,handleDeleteItem:q,isDeleting:r})=>{let s=m.has(a.id);return(0,b.jsxs)(c.default.Fragment,{children:[(0,b.jsxs)(e.TableRow,{className:0===l?"font-bold bg-muted hover:bg-muted/90":"hover:bg-muted/50",children:[(0,b.jsx)(e.TableCell,{className:`sticky left-0 z-10 whitespace-nowrap ${0===l?"bg-muted":"bg-background"}`,style:{paddingLeft:`${1+1.5*l}rem`},children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(J,{checked:o.has(a.id),onCheckedChange:()=>p(a.id)}),a.children.length>0?(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:()=>n(a.id),className:"h-8 w-8",children:s?(0,b.jsx)(g.ChevronDown,{className:"h-4 w-4"}):(0,b.jsx)(h.ChevronRight,{className:"h-4 w-4"})}):(0,b.jsx)("span",{className:"w-8 h-8"}),(0,b.jsx)("span",{children:a.name}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-60 hover:opacity-100",onClick:()=>q(a.id,a.name),disabled:r,children:(0,b.jsx)(j,{className:"h-3 w-3"})})]})}),d.map(d=>{let f=i[a.id]?.[d.key]||{budget:0,actual:0},g=f.budget,h=f.actual,j=0===g?0:h/g*100;return(0,b.jsxs)(c.default.Fragment,{children:[("all"===k||"budget"===k)&&(0,b.jsx)(e.TableCell,{className:"text-right font-mono border-l whitespace-nowrap px-2",children:L(g)}),("all"===k||"actual"===k)&&(0,b.jsx)(e.TableCell,{className:`text-right font-mono whitespace-nowrap px-2 ${"actual"===k?"border-l":""}`,children:L(h)}),"all"===k&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.TableCell,{className:"text-right font-mono whitespace-nowrap px-2",children:L(h-g)}),(0,b.jsxs)(e.TableCell,{className:"text-right font-mono border-r whitespace-nowrap px-2",children:[j.toFixed(0),"%"]})]})]},d.key)})]}),s&&a.children.map(a=>(0,b.jsx)(M,{item:a,headers:d,data:i,viewMode:k,level:l+1,expandedRows:m,toggleRow:n,selectedItems:o,toggleItemSelection:p,handleDeleteItem:q,isDeleting:r},a.id))]})};function N({headers:a,rows:d,data:g,viewMode:h="all",onDataChange:i}){let[k,l]=(0,c.useState)(()=>new Set(d.map(a=>a.id))),[m,n]=(0,c.useState)(new Set),[o,p]=(0,c.useState)(!1),q=(0,c.useMemo)(()=>{let a=new Set,b=c=>{c.forEach(c=>{a.add(c.id),c.children.length>0&&b(c.children)})};return b(d),a},[d]),r=a=>{l(b=>{let c=new Set(b);return c.has(a)?c.delete(a):c.add(a),c})},s=a=>{n(b=>{let c=new Set(b);return c.has(a)?c.delete(a):c.add(a),c})},t=async()=>{if(0===m.size)return K.toast.error("削除する項目を選択してください。");if(confirm(`選択した${m.size}件の項目を削除しますか？`)){p(!0);try{if(!(await fetch("/api/account-items/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemIds:Array.from(m)})})).ok)throw Error("Delete failed");K.toast.success("項目を削除しました。"),n(new Set),i?.()}catch(a){K.toast.error("削除に失敗しました。")}finally{p(!1)}}},u=async(a,b)=>{if(!confirm(`「${b}」を削除しますか？`))return};return(0,b.jsxs)("div",{className:"bg-background rounded-lg overflow-x-auto",children:[m.size>0&&(0,b.jsxs)("div",{className:"p-4 bg-muted flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-sm font-medium",children:[m.size,"件選択中"]}),(0,b.jsxs)(f.Button,{variant:"destructive",size:"sm",onClick:t,disabled:o,children:[(0,b.jsx)(j,{className:"h-4 w-4 mr-2"}),"選択項目を削除"]})]}),(0,b.jsxs)(e.Table,{children:[(0,b.jsxs)(e.TableHeader,{children:[(0,b.jsxs)(e.TableRow,{children:[(0,b.jsx)(e.TableHead,{rowSpan:2,className:"w-[250px] min-w-[250px] sticky left-0 bg-background z-10 align-middle border-b",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(J,{checked:m.size>0&&m.size===q.size,onCheckedChange:()=>{m.size>0?n(new Set):n(q)}}),"勘定項目"]})}),a.map(a=>(0,b.jsx)(e.TableHead,{colSpan:"all"===h?4:"budget"===h||"actual"===h?1:4,className:"text-center border-l font-bold",children:a.label},a.key))]}),(0,b.jsx)(e.TableRow,{children:a.map(a=>(0,b.jsxs)(c.default.Fragment,{children:[("all"===h||"budget"===h)&&(0,b.jsx)(e.TableHead,{className:"min-w-[100px] text-right font-normal text-xs border-l whitespace-nowrap px-2",children:"予算"}),("all"===h||"actual"===h)&&(0,b.jsx)(e.TableHead,{className:`min-w-[100px] text-right font-normal text-xs whitespace-nowrap px-2 ${"actual"===h?"border-l":""}`,children:"実績"}),"all"===h&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.TableHead,{className:"min-w-[100px] text-right font-normal text-xs whitespace-nowrap px-2",children:"差異"}),(0,b.jsx)(e.TableHead,{className:"min-w-[100px] text-right font-normal text-xs border-r whitespace-nowrap px-2",children:"達成率"})]})]},a.key))})]}),(0,b.jsx)(e.TableBody,{children:d.map(c=>(0,b.jsx)(M,{item:c,headers:a,data:g,viewMode:h,level:0,expandedRows:k,toggleRow:r,selectedItems:m,toggleItemSelection:s,handleDeleteItem:u,isDeleting:o},c.id))})]})]})}let O=(0,i.default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),P=(0,i.default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);var Q=a.i(92024),R=a.i(27770),S=a.i(45095),T=a.i(52001),U=a.i(79970),V=a.i(15053),W=a.i(10784),X=a.i(11775),Y=a.i(16164),Z=a.i(87003),$="Popover",[_,aa]=(0,l.createContextScope)($,[V.createPopperScope]),ab=(0,V.createPopperScope)(),[ac,ad]=_($),ae=a=>{let{__scopePopover:d,children:e,open:f,defaultOpen:g,onOpenChange:h,modal:i=!1}=a,j=ab(d),k=c.useRef(null),[l,m]=c.useState(!1),[o,p]=(0,n.useControllableState)({prop:f,defaultProp:g??!1,onChange:h,caller:$});return(0,b.jsx)(V.Root,{...j,children:(0,b.jsx)(ac,{scope:d,contentId:(0,U.useId)(),triggerRef:k,open:o,onOpenChange:p,onOpenToggle:c.useCallback(()=>p(a=>!a),[p]),hasCustomAnchor:l,onCustomAnchorAdd:c.useCallback(()=>m(!0),[]),onCustomAnchorRemove:c.useCallback(()=>m(!1),[]),modal:i,children:e})})};ae.displayName=$;var af="PopoverAnchor";c.forwardRef((a,d)=>{let{__scopePopover:e,...f}=a,g=ad(af,e),h=ab(e),{onCustomAnchorAdd:i,onCustomAnchorRemove:j}=g;return c.useEffect(()=>(i(),()=>j()),[i,j]),(0,b.jsx)(V.Anchor,{...h,...f,ref:d})}).displayName=af;var ag="PopoverTrigger",ah=c.forwardRef((a,c)=>{let{__scopePopover:d,...e}=a,f=ad(ag,d),g=ab(d),h=(0,k.useComposedRefs)(c,f.triggerRef),i=(0,b.jsx)(r.Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":f.open,"aria-controls":f.contentId,"data-state":at(f.open),...e,ref:h,onClick:(0,m.composeEventHandlers)(a.onClick,f.onOpenToggle)});return f.hasCustomAnchor?i:(0,b.jsx)(V.Anchor,{asChild:!0,...g,children:i})});ah.displayName=ag;var ai="PopoverPortal",[aj,ak]=_(ai,{forceMount:void 0}),al=a=>{let{__scopePopover:c,forceMount:d,children:e,container:f}=a,g=ad(ai,c);return(0,b.jsx)(aj,{scope:c,forceMount:d,children:(0,b.jsx)(q.Presence,{present:d||g.open,children:(0,b.jsx)(W.Portal,{asChild:!0,container:f,children:e})})})};al.displayName=ai;var am="PopoverContent",an=c.forwardRef((a,c)=>{let d=ak(am,a.__scopePopover),{forceMount:e=d.forceMount,...f}=a,g=ad(am,a.__scopePopover);return(0,b.jsx)(q.Presence,{present:e||g.open,children:g.modal?(0,b.jsx)(ap,{...f,ref:c}):(0,b.jsx)(aq,{...f,ref:c})})});an.displayName=am;var ao=(0,X.createSlot)("PopoverContent.RemoveScroll"),ap=c.forwardRef((a,d)=>{let e=ad(am,a.__scopePopover),f=c.useRef(null),g=(0,k.useComposedRefs)(d,f),h=c.useRef(!1);return c.useEffect(()=>{let a=f.current;if(a)return(0,Y.hideOthers)(a)},[]),(0,b.jsx)(Z.RemoveScroll,{as:ao,allowPinchZoom:!0,children:(0,b.jsx)(ar,{...a,ref:g,trapFocus:e.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,m.composeEventHandlers)(a.onCloseAutoFocus,a=>{a.preventDefault(),h.current||e.triggerRef.current?.focus()}),onPointerDownOutside:(0,m.composeEventHandlers)(a.onPointerDownOutside,a=>{let b=a.detail.originalEvent,c=0===b.button&&!0===b.ctrlKey;h.current=2===b.button||c},{checkForDefaultPrevented:!1}),onFocusOutside:(0,m.composeEventHandlers)(a.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1})})})}),aq=c.forwardRef((a,d)=>{let e=ad(am,a.__scopePopover),f=c.useRef(!1),g=c.useRef(!1);return(0,b.jsx)(ar,{...a,ref:d,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:b=>{a.onCloseAutoFocus?.(b),b.defaultPrevented||(f.current||e.triggerRef.current?.focus(),b.preventDefault()),f.current=!1,g.current=!1},onInteractOutside:b=>{a.onInteractOutside?.(b),b.defaultPrevented||(f.current=!0,"pointerdown"===b.detail.originalEvent.type&&(g.current=!0));let c=b.target;e.triggerRef.current?.contains(c)&&b.preventDefault(),"focusin"===b.detail.originalEvent.type&&g.current&&b.preventDefault()}})}),ar=c.forwardRef((a,c)=>{let{__scopePopover:d,trapFocus:e,onOpenAutoFocus:f,onCloseAutoFocus:g,disableOutsidePointerEvents:h,onEscapeKeyDown:i,onPointerDownOutside:j,onFocusOutside:k,onInteractOutside:l,...m}=a,n=ad(am,d),o=ab(d);return(0,S.useFocusGuards)(),(0,b.jsx)(T.FocusScope,{asChild:!0,loop:!0,trapped:e,onMountAutoFocus:f,onUnmountAutoFocus:g,children:(0,b.jsx)(R.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:h,onInteractOutside:l,onEscapeKeyDown:i,onPointerDownOutside:j,onFocusOutside:k,onDismiss:()=>n.onOpenChange(!1),children:(0,b.jsx)(V.Content,{"data-state":at(n.open),role:"dialog",id:n.contentId,...o,...m,ref:c,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),as="PopoverClose";function at(a){return a?"open":"closed"}c.forwardRef((a,c)=>{let{__scopePopover:d,...e}=a,f=ad(as,d);return(0,b.jsx)(r.Primitive.button,{type:"button",...e,ref:c,onClick:(0,m.composeEventHandlers)(a.onClick,()=>f.onOpenChange(!1))})}).displayName=as,c.forwardRef((a,c)=>{let{__scopePopover:d,...e}=a,f=ab(d);return(0,b.jsx)(V.Arrow,{...f,...e,ref:c})}).displayName="PopoverArrow";let au=c.forwardRef(({className:a,align:c="center",sideOffset:d=4,...e},f)=>(0,b.jsx)(al,{children:(0,b.jsx)(an,{ref:f,align:c,sideOffset:d,className:(0,I.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",a),...e})}));function av({mediaId:a,onImportComplete:d,dataToExport:g,selectedYear:h,fiscalYearStartMonth:i}){let[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)("budget"),r=async(a,b)=>{let c=a.target.files?.[0];if(c){q(b);try{let a=(await c.text()).trim().split("\n");if(a.length<2)return void K.toast.error("ファイルが空です。");let d=c.name.endsWith(".tsv")||a[0].includes("	"),e=d?"	":",";d||K.toast.warning("CSV形式を検出しました。数値にカンマ（,）が含まれていないか確認してください。推奨形式: TSV",{duration:5e3});let f=a[0].split(e).map(a=>a.trim()),g=a.slice(1),j="budget",l=[],n=f.some(a=>a.includes("予算")),o=f.some(a=>a.includes("実績"));n&&o?(j="both",f.slice(2).forEach(a=>{let b=a.match(/(\d+)月/);b&&!l.includes(parseInt(b[1]))&&l.push(parseInt(b[1]))})):(j=b,f.slice(2).forEach(a=>{let b=a.match(/(\d+)月/);b&&l.push(parseInt(b[1]))}));let p=g.map(a=>{let b=a.split(e).map(a=>a.trim()),c=b[0],d=b[1],f=[];return"both"===j?l.forEach((a,c)=>{let d=a<i?h+1:h,e=parseFloat(b[2+2*c]?.replace(/,/g,"")||"0")||0,g=parseFloat(b[2+2*c+1]?.replace(/,/g,"")||"0")||0;f.push({year:d,month:a,budget:e,actual:g})}):l.forEach((a,c)=>{let d=a<i?h+1:h,e=parseFloat(b[2+c]?.replace(/,/g,"")||"0")||0;"budget"===j?f.push({year:d,month:a,budget:e,actual:null}):f.push({year:d,month:a,budget:null,actual:e})}),{parent:c,account_item:d,values:f}});if(p.filter(a=>!a.account_item||!a.parent).length>0)return void K.toast.error("ファイルの形式が正しくありません。勘定項目名と親項目は必須です。");m({mode:j,months:l,items:p}),k(!0)}catch(a){console.error("File parse error:",a),K.toast.error("ファイルの読み込みに失敗しました。")}a.target.value=""}},s=a=>{let b=new Blob(["both"===a?`parent	account_item	4月予算	4月実績	5月予算	5月実績	6月予算	6月実績
売上	広告収入	1,000,000	950,000	1,200,000	1,100,000	1,100,000	1,050,000
売上	制作収入	500,000	480,000	550,000	520,000	600,000	580,000
費用	人件費	800,000	800,000	800,000	800,000	800,000	800,000
費用	広告費	300,000	280,000	350,000	320,000	400,000	380,000`:"budget"===a?`parent	account_item	4月	5月	6月	7月	8月	9月
売上	広告収入	1,000,000	1,200,000	1,100,000	1,300,000	1,400,000	1,500,000
売上	制作収入	500,000	550,000	600,000	650,000	700,000	750,000
費用	人件費	800,000	800,000	800,000	800,000	800,000	800,000
費用	広告費	300,000	350,000	400,000	450,000	500,000	550,000`:`parent	account_item	4月	5月	6月	7月	8月	9月
売上	広告収入	950,000	1,100,000	1,050,000	1,250,000	1,350,000	1,450,000
売上	制作収入	480,000	520,000	580,000	620,000	680,000	720,000
費用	人件費	800,000	800,000	800,000	800,000	800,000	800,000
費用	広告費	280,000	320,000	380,000	420,000	480,000	520,000`],{type:"text/tab-separated-values;charset=utf-8;"}),c=document.createElement("a"),d=URL.createObjectURL(b);c.setAttribute("href",d),c.setAttribute("download","both"===a?"budget_actual_template.tsv":"budget"===a?"budget_template.tsv":"actual_template.tsv"),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(d)},t=async()=>{if("all"===a)return void K.toast.error("メディアを選択してください。");if(!l)return void K.toast.error("データがありません。");o(!0);try{let b=await fetch("/api/financials/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mediaId:a,items:l.items})});if(!b.ok){let a=await b.json();throw Error(a.error||"Import failed")}K.toast.success("データをインポートしました。"),k(!1),m(null),d()}catch(a){console.error("Import error:",a),K.toast.error(a instanceof Error?a.message:"インポートに失敗しました。")}finally{o(!1)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(ae,{children:[(0,b.jsx)(ah,{asChild:!0,children:(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",className:"h-8 gap-2",children:[(0,b.jsx)(P,{className:"h-4 w-4"}),"ダウンロード"]})}),(0,b.jsx)(au,{className:"w-60",align:"start",children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("h4",{className:"font-medium text-sm px-2 pt-1.5 pb-1",children:"現在のデータをエクスポート"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"w-full justify-start",onClick:()=>{if(!g||0===g.length)return void K.toast.error("エクスポートするデータがありません。");let b=(a=>{let b=new Map,c=[];return a?(a.forEach(a=>{b.has(a.account_item_id)||b.set(a.account_item_id,{id:a.account_item_id,name:a.account_item_name,parentId:a.parent_id,displayOrder:a.display_order,children:[],monthlyData:{}}),b.get(a.account_item_id).monthlyData[a.month]={budget:a.total_budget,actual:a.total_actual}}),b.forEach(a=>{a.parentId&&b.has(a.parentId)?b.get(a.parentId).children.push(a):c.push(a)}),c.forEach(a=>{a.children.sort((a,b)=>a.displayOrder-b.displayOrder)}),c.sort((a,b)=>a.displayOrder-b.displayOrder)):[]})(g),c=[...new Set(g.map(a=>a.month))].sort((a,b)=>a-b),d=new Blob([[["parent","account_item",...c.flatMap(a=>[`${a}月予算`,`${a}月実績`])].join("	"),...b.flatMap(a=>[["",a.name,...c.flatMap(b=>{let c=a.monthlyData[b]||{budget:0,actual:0};return[c.budget,c.actual]})].join("	"),...a.children.map(b=>[a.name,b.name,...c.flatMap(a=>{let c=b.monthlyData[a]||{budget:0,actual:0};return[c.budget,c.actual]})].join("	"))])].join("\n")],{type:"text/tab-separated-values;charset=utf-8;"}),e=document.createElement("a"),f=URL.createObjectURL(d),h=`financial_data_${a}_${new Date().toISOString().split("T")[0]}.tsv`;e.setAttribute("href",f),e.setAttribute("download",h),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(f),K.toast.success("データのエクスポートが完了しました。")},children:"TSV形式でエクスポート"}),(0,b.jsx)("hr",{className:"my-2"}),(0,b.jsx)("h4",{className:"font-medium text-sm px-2 pt-1.5 pb-1",children:"空のテンプレート"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"w-full justify-start",onClick:()=>s("both"),children:"予算・実績両方 (TSV)"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"w-full justify-start",onClick:()=>s("budget"),children:"予算のみ (TSV)"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"w-full justify-start",onClick:()=>s("actual"),children:"実績のみ (TSV)"})]})})]}),(0,b.jsxs)(ae,{children:[(0,b.jsx)(ah,{asChild:!0,children:(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",className:"h-8 gap-2",children:[(0,b.jsx)(O,{className:"h-4 w-4"}),"インポート"]})}),(0,b.jsx)(au,{className:"w-56",align:"start",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h4",{className:"font-medium text-sm mb-2",children:"インポート種類"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"w-full justify-start",onClick:()=>document.getElementById("csv-upload-budget")?.click(),children:"予算データ"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"w-full justify-start",onClick:()=>document.getElementById("csv-upload-actual")?.click(),children:"実績データ"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-2 px-2",children:"※TSV/CSV両方対応"})]})})]})]}),(0,b.jsx)("input",{id:"csv-upload-budget",type:"file",accept:".tsv,.csv",className:"hidden",onChange:a=>r(a,"budget")}),(0,b.jsx)("input",{id:"csv-upload-actual",type:"file",accept:".tsv,.csv",className:"hidden",onChange:a=>r(a,"actual")}),(0,b.jsx)(Q.Dialog,{open:j,onOpenChange:k,children:(0,b.jsxs)(Q.DialogContent,{className:"max-w-6xl max-h-[80vh] overflow-hidden flex flex-col",children:[(0,b.jsxs)(Q.DialogHeader,{children:[(0,b.jsx)(Q.DialogTitle,{children:"データインポート確認"}),(0,b.jsxs)(Q.DialogDescription,{children:["以下の内容でインポートします。同じ親項目配下のデータは部分更新されます。",(0,b.jsx)("br",{}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"※TSV形式推奨（カンマ入り数値対応）"})]})]}),(0,b.jsx)("div",{className:"overflow-auto flex-1",children:l&&(0,b.jsxs)(e.Table,{children:[(0,b.jsx)(e.TableHeader,{children:(0,b.jsxs)(e.TableRow,{children:[(0,b.jsx)(e.TableHead,{className:"sticky left-0 bg-background",children:"親項目"}),(0,b.jsx)(e.TableHead,{children:"勘定項目"}),l.months.map(a=>(0,b.jsxs)(c.default.Fragment,{children:[("both"===l.mode||"budget"===l.mode)&&(0,b.jsxs)(e.TableHead,{className:"text-right",children:[a,"月予算"]}),("both"===l.mode||"actual"===l.mode)&&(0,b.jsxs)(e.TableHead,{className:"text-right",children:[a,"月実績"]})]},a))]})}),(0,b.jsx)(e.TableBody,{children:l.items.map((a,d)=>(0,b.jsxs)(e.TableRow,{children:[(0,b.jsx)(e.TableCell,{className:"sticky left-0 bg-background font-medium",children:a.parent}),(0,b.jsx)(e.TableCell,{children:a.account_item}),l.months.map(d=>{let f=a.values.find(a=>a.month===d);return(0,b.jsxs)(c.default.Fragment,{children:[("both"===l.mode||"budget"===l.mode)&&(0,b.jsx)(e.TableCell,{className:"text-right font-mono",children:f?.budget?.toLocaleString()??"-"}),("both"===l.mode||"actual"===l.mode)&&(0,b.jsx)(e.TableCell,{className:"text-right font-mono",children:f?.actual?.toLocaleString()??"-"})]},d)})]},d))})]})}),(0,b.jsxs)(Q.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>k(!1),disabled:n,children:"キャンセル"}),(0,b.jsx)(f.Button,{onClick:t,disabled:n,children:n?"インポート中...":"インポート"})]})]})})]})}au.displayName=an.displayName;let aw=(0,i.default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);var ax=a.i(54935),ay=a.i(88305),az=a.i(43535),aA="Toggle",aB=c.forwardRef((a,c)=>{let{pressed:d,defaultPressed:e,onPressedChange:f,...g}=a,[h,i]=(0,n.useControllableState)({prop:d,onChange:f,defaultProp:e??!1,caller:aA});return(0,b.jsx)(r.Primitive.button,{type:"button","aria-pressed":h,"data-state":h?"on":"off","data-disabled":a.disabled?"":void 0,...g,ref:c,onClick:(0,m.composeEventHandlers)(a.onClick,()=>{a.disabled||i(!h)})})});aB.displayName=aA;var aC=a.i(53209),aD="ToggleGroup",[aE,aF]=(0,l.createContextScope)(aD,[az.createRovingFocusGroupScope]),aG=(0,az.createRovingFocusGroupScope)(),aH=c.default.forwardRef((a,c)=>{let{type:d,...e}=a;if("single"===d)return(0,b.jsx)(aK,{...e,ref:c});if("multiple"===d)return(0,b.jsx)(aL,{...e,ref:c});throw Error(`Missing prop \`type\` expected on \`${aD}\``)});aH.displayName=aD;var[aI,aJ]=aE(aD),aK=c.default.forwardRef((a,d)=>{let{value:e,defaultValue:f,onValueChange:g=()=>{},...h}=a,[i,j]=(0,n.useControllableState)({prop:e,defaultProp:f??"",onChange:g,caller:aD});return(0,b.jsx)(aI,{scope:a.__scopeToggleGroup,type:"single",value:c.default.useMemo(()=>i?[i]:[],[i]),onItemActivate:j,onItemDeactivate:c.default.useCallback(()=>j(""),[j]),children:(0,b.jsx)(aO,{...h,ref:d})})}),aL=c.default.forwardRef((a,d)=>{let{value:e,defaultValue:f,onValueChange:g=()=>{},...h}=a,[i,j]=(0,n.useControllableState)({prop:e,defaultProp:f??[],onChange:g,caller:aD}),k=c.default.useCallback(a=>j((b=[])=>[...b,a]),[j]),l=c.default.useCallback(a=>j((b=[])=>b.filter(b=>b!==a)),[j]);return(0,b.jsx)(aI,{scope:a.__scopeToggleGroup,type:"multiple",value:i,onItemActivate:k,onItemDeactivate:l,children:(0,b.jsx)(aO,{...h,ref:d})})});aH.displayName=aD;var[aM,aN]=aE(aD),aO=c.default.forwardRef((a,c)=>{let{__scopeToggleGroup:d,disabled:e=!1,rovingFocus:f=!0,orientation:g,dir:h,loop:i=!0,...j}=a,k=aG(d),l=(0,aC.useDirection)(h),m={role:"group",dir:l,...j};return(0,b.jsx)(aM,{scope:d,rovingFocus:f,disabled:e,children:f?(0,b.jsx)(az.Root,{asChild:!0,...k,orientation:g,dir:l,loop:i,children:(0,b.jsx)(r.Primitive.div,{...m,ref:c})}):(0,b.jsx)(r.Primitive.div,{...m,ref:c})})}),aP="ToggleGroupItem",aQ=c.default.forwardRef((a,d)=>{let e=aJ(aP,a.__scopeToggleGroup),f=aN(aP,a.__scopeToggleGroup),g=aG(a.__scopeToggleGroup),h=e.value.includes(a.value),i=f.disabled||a.disabled,j={...a,pressed:h,disabled:i},k=c.default.useRef(null);return f.rovingFocus?(0,b.jsx)(az.Item,{asChild:!0,...g,focusable:!i,active:h,ref:k,children:(0,b.jsx)(aR,{...j,ref:d})}):(0,b.jsx)(aR,{...j,ref:d})});aQ.displayName=aP;var aR=c.default.forwardRef((a,c)=>{let{__scopeToggleGroup:d,value:e,...f}=a,g=aJ(aP,d),h={role:"radio","aria-checked":a.pressed,"aria-pressed":void 0},i="single"===g.type?h:void 0;return(0,b.jsx)(aB,{...i,...f,ref:c,onPressedChange:a=>{a?g.onItemActivate(e):g.onItemDeactivate(e)}})});let aS=(0,a.i(42261).cva)("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-xs hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-2 min-w-9",sm:"h-8 px-1.5 min-w-8",lg:"h-10 px-2.5 min-w-10"}},defaultVariants:{variant:"default",size:"default"}}),aT=c.createContext({size:"default",variant:"default"}),aU=c.forwardRef(({className:a,variant:c,size:d,children:e,...f},g)=>(0,b.jsx)(aH,{ref:g,className:(0,I.cn)("flex items-center justify-center gap-1",a),...f,children:(0,b.jsx)(aT.Provider,{value:{variant:c,size:d},children:e})}));aU.displayName=aH.displayName;let aV=c.forwardRef(({className:a,children:d,variant:e,size:f,...g},h)=>{let i=c.useContext(aT);return(0,b.jsx)(aQ,{ref:h,className:(0,I.cn)(aS({variant:i.variant||e,size:i.size||f}),a),...g,children:d})});aV.displayName=aQ.displayName;let aW=a=>{(a=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()))).setUTCDate(a.getUTCDate()+4-(a.getUTCDay()||7));let b=new Date(Date.UTC(a.getUTCFullYear(),0,1)),c=Math.ceil(((a.getTime()-b.getTime())/864e5+1)/7);return{year:a.getUTCFullYear(),week:c}},aX=(a,b)=>{let c=new Date(Date.UTC(a,0,1+(b-1)*7));return c.setUTCDate(c.getUTCDate()+1-c.getUTCDay()),c},aY=(a,b)=>{let c=aX(a,b),d=new Date(c);return d.setUTCDate(c.getUTCDate()+6),d};function aZ({monthlyData:a,dailyData:e,accountItems:g,fiscalYearStartMonth:h}){let i=(0,d.useRouter)(),j=(0,d.useSearchParams)(),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)("monthly"),o=j.get("media")||"all",p=parseInt(j.get("year")||new Date().getFullYear().toString()),[q,r]=(0,c.useState)(p),[s,t]=(0,c.useState)("all"),u=new Date().getFullYear(),v=Array.from({length:11},(a,b)=>u-5+b),w=()=>i.refresh(),x=(0,c.useMemo)(()=>{let b=g.reduce((a,b)=>(a[b.id]={...b,children:[]},a),{}),c=[];Object.values(b).forEach(a=>{a.parent_id&&b[a.parent_id]?b[a.parent_id].children.push(a):c.push(a)}),c.forEach(a=>a.children.sort((a,b)=>a.display_order-b.display_order)),c.sort((a,b)=>a.display_order-b.display_order);let d=e.reduce((a,b)=>(a[b.account_item_id]||(a[b.account_item_id]=[]),a[b.account_item_id].push(b),a),{}),f=[],i={},j=a=>{let b=a.children?.flatMap(a=>d[a.id]||[])||[];return[...d[a.id]||[],...b]},k=new Date(q,h-1,1),l=new Date(q+1,h-1,0);if("monthly"===m){Array.from({length:12},(a,b)=>(b+h-1)%12+1).forEach(a=>f.push({key:`m-${a}`,label:`${a}月`}));let c=a.reduce((a,b)=>(a[b.account_item_id]||(a[b.account_item_id]=[]),a[b.account_item_id].push(b),a),{});Object.values(b).forEach(a=>{i[a.id]={};let b=a.children?.flatMap(a=>c[a.id]||[])||[],d=[...c[a.id]||[],...b];f.forEach(b=>{let c=parseInt(b.key.split("-")[1]),e=d.filter(a=>a.item_month===c);i[a.id][b.key]={budget:e.reduce((a,b)=>a+b.budget,0),actual:e.reduce((a,b)=>a+b.actual,0)}})})}else if("weekly"===m){let a=new Map,c=new Date(k);for(;c<=l;){let{year:b,week:d}=aW(c),e=`w-${b}-${d}`;if(!a.has(e)){let c=aX(b,d),f=aY(b,d);a.set(e,{year:b,week:d,start:c,end:f})}c.setDate(c.getDate()+1)}Array.from(a.values()).sort((a,b)=>a.year-b.year||a.week-b.week).forEach(({year:a,week:b,start:c,end:d})=>{f.push({key:`w-${a}-${b}`,label:`${c.getMonth()+1}/${c.getDate()}-${d.getMonth()+1}/${d.getDate()}`})}),Object.values(b).forEach(a=>{i[a.id]={};let b=j(a);f.forEach(c=>{let[,d,e]=c.key.split("-").map(Number),f=aX(d,e),g=aY(d,e),h=b.filter(a=>{let b=new Date(a.item_date);return b>=f&&b<=g});i[a.id][c.key]={budget:h.reduce((a,b)=>a+b.budget,0),actual:h.reduce((a,b)=>a+b.actual,0)}})})}else if("daily"===m){let a=new Date(k);for(;a<=l;){let b=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0"),d=String(a.getDate()).padStart(2,"0"),e=`${b}-${c}-${d}`;f.push({key:`d-${e}`,label:`${a.getMonth()+1}/${a.getDate()}`}),a.setDate(a.getDate()+1)}Object.values(b).forEach(a=>{i[a.id]={};let b=j(a);f.forEach(c=>{let d=c.key.substring(2),e=b.filter(a=>a.item_date===d);i[a.id][c.key]={budget:e.reduce((a,b)=>a+b.budget,0),actual:e.reduce((a,b)=>a+b.actual,0)}})})}return{headers:f,rows:c,data:i}},[a,e,g,m,h,q]),y=+(q!==u)+ +("all"!==s);return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsx)(av,{mediaId:o,onImportComplete:w,dataToExport:[],selectedYear:q,fiscalYearStartMonth:h}),(0,b.jsxs)(ae,{open:k,onOpenChange:l,children:[(0,b.jsx)(ah,{asChild:!0,children:(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",className:"h-8 gap-2",children:[(0,b.jsx)(aw,{className:"h-4 w-4"}),"Filter",y>0&&(0,b.jsx)("span",{className:"ml-1 rounded-full bg-primary px-2 py-0.5 text-xs text-primary-foreground",children:y})]})}),(0,b.jsx)(au,{className:"w-80",align:"start",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h4",{className:"font-medium",children:"フィルター"}),y>0&&(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>{r(u),t("all");let a=new URLSearchParams(j.toString());a.delete("year"),i.push(`?${a.toString()}`)},className:"h-auto p-1 text-xs",children:"リセット"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(ay.Label,{className:"text-sm font-medium",children:"会計年度"}),(0,b.jsx)("select",{value:q,onChange:a=>r(parseInt(a.target.value)),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:v.map(a=>(0,b.jsxs)("option",{value:a,children:[a,"年度"]},a))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(ay.Label,{className:"text-sm font-medium",children:"表示項目"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(J,{id:"view-all",checked:"all"===s,onCheckedChange:()=>t("all")}),(0,b.jsx)("label",{htmlFor:"view-all",className:"text-sm leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"予実比較"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(J,{id:"view-budget",checked:"budget"===s,onCheckedChange:()=>t("budget")}),(0,b.jsx)("label",{htmlFor:"view-budget",className:"text-sm leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"予算のみ"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(J,{id:"view-actual",checked:"actual"===s,onCheckedChange:()=>t("actual")}),(0,b.jsx)("label",{htmlFor:"view-actual",className:"text-sm leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"実績のみ"})]})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,b.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>l(!1),children:"キャンセル"}),(0,b.jsx)(f.Button,{size:"sm",onClick:()=>{let a=new URLSearchParams(j.toString());a.set("year",q.toString()),i.push(`?${a.toString()}`),l(!1)},children:"適用"})]})]})})]}),y>0&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[q!==u&&(0,b.jsxs)("div",{className:"flex items-center gap-1 rounded-md bg-secondary px-2 py-1 text-xs",children:[(0,b.jsxs)("span",{children:["会計年度: ",q,"年度"]}),(0,b.jsx)("button",{onClick:()=>{r(u);let a=new URLSearchParams(j.toString());a.delete("year"),i.push(`?${a.toString()}`)},className:"ml-1 hover:bg-secondary-foreground/10 rounded",children:(0,b.jsx)(ax.X,{className:"h-3 w-3"})})]}),"all"!==s&&(0,b.jsxs)("div",{className:"flex items-center gap-1 rounded-md bg-secondary px-2 py-1 text-xs",children:[(0,b.jsx)("span",{children:"budget"===s?"予算のみ":"実績のみ"}),(0,b.jsx)("button",{onClick:()=>t("all"),className:"ml-1 hover:bg-secondary-foreground/10 rounded",children:(0,b.jsx)(ax.X,{className:"h-3 w-3"})})]})]}),(0,b.jsxs)(aU,{type:"single",variant:"outline",size:"sm",value:m,onValueChange:a=>a&&n(a),children:[(0,b.jsx)(aV,{value:"monthly",children:"月次"}),(0,b.jsx)(aV,{value:"weekly",children:"週次"}),(0,b.jsx)(aV,{value:"daily",children:"日次"})]})]}),(0,b.jsx)(N,{headers:x.headers,rows:x.rows,data:x.data,viewMode:s,onDataChange:w})]})}}];

//# sourceMappingURL=apps_dashboard_src_components_financials_financials-client_tsx_6d1db800._.js.map